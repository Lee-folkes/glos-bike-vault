const c=document.getElementById("registerBikeModal"),l=document.getElementById("registerBikeModalLabel"),a=document.getElementById("registerBikeForm"),m=document.getElementById("formMethod"),y=a.getAttribute("action"),b=document.getElementById("BikeSubmitBtn"),g=["nickname","brand","model","type","mpn","wheel_size","colour","num_gears","brake_type","suspension","gender","age_group"];function h(){l.textContent="Register New Bike",b.textContent="Register Bike",a.action=y,m.value="POST",a.reset(),c.removeAttribute("inert")}function p(t,e){l.textContent="Edit Bike",b.textContent="Update Bike",a.action=y+"/"+t,m.value="PUT",g.forEach(function(o){const i=a.querySelector('[name="'+o+'"]');i&&(i.value=e[o]||"")}),c.removeAttribute("inert")}function k(){c.setAttribute("inert","")}document.getElementById("registerBikeBtn").addEventListener("click",h);document.getElementById("closeModalBtn").addEventListener("click",k);c.addEventListener("click",function(t){t.target===c&&k()});document.querySelectorAll(".action-edit").forEach(function(t){t.addEventListener("click",function(){const e=this.getAttribute("data-bike-id"),o=JSON.parse(this.getAttribute("data-bike"));p(e,o)})});function v(t){const e=this.closest(".bike-card").querySelector(".bike-card-status-menu");e&&(e.style.visibility="visible",e.style.opacity="1")}document.querySelectorAll(".action-status").forEach(function(t){t.addEventListener("click",v)});document.addEventListener("click",function(t){!t.target.closest(".bike-card-status-menu")&&!t.target.closest(".action-status")&&document.querySelectorAll(".bike-card-status-menu").forEach(function(e){e.style.visibility="hidden",e.style.opacity="0"})});document.querySelectorAll(".status-option").forEach(function(t){t.addEventListener("click",function(){const e=this.getAttribute("data-bike-id"),o=this.getAttribute("data-status"),i=this.closest(".bike-card"),d=i.querySelector(".bike-card-status-menu");fetch("/bikes/"+e+"/status",{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json"},body:JSON.stringify({status:o})}).then(function(n){if(!n.ok)throw new Error("Status update failed");return n.json()}).then(function(n){var r=i.querySelectorAll(".bike-card-header .bike-card-type"),u=r.length>1?r[r.length-1]:r[0];u&&(u.className="bike-card-type status-"+n.status,u.textContent=n.status.charAt(0).toUpperCase()+n.status.slice(1)),d&&(d.style.visibility="hidden",d.style.opacity="0");var s=i.querySelector(".bike-card-actions");s&&(s.style.visibility="hidden",s.style.opacity="0"),i.classList.add("hide-actions"),i.addEventListener("mouseleave",function f(){i.classList.remove("hide-actions"),s&&(s.style.removeProperty("visibility"),s.style.removeProperty("opacity")),i.removeEventListener("mouseleave",f)})}).catch(function(n){console.error("Error updating status:",n),alert("Failed to update bike status. Please try again.")})})});
